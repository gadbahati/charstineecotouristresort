<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Admin Dashboard</title>
    <style>body{font-family:Arial;margin:20px}table{border-collapse:collapse;width:100%}th,td{border:1px solid #ddd;padding:8px}th{background:#f4f4f4}</style>
  </head>
  <body>
    <h1>Admin Dashboard</h1>
    <button id="logout">Logout</button>

    <h2>Inventory</h2>
    <form id="addItem">
      <input name="name" placeholder="Item name" required>
      <input name="category" placeholder="Category">
      <input name="quantity" type="number" placeholder="Quantity" value="1">
      <input name="description" placeholder="Description">
      <button>Add Item</button>
    </form>
    <div id="items"></div>

    <h2>Record Rental</h2>
    <form id="addRental">
      <select name="item_id" id="r_item"></select>
      <input name="quantity" type="number" value="1" min="1">
      <input name="renter_name" placeholder="Renter name (optional)">
      <input name="hire_date" type="date">
      <input name="return_date" type="date">
      <input name="price" type="number" step="0.01" placeholder="Price paid">
      <button>Record Rental</button>
    </form>

    <h2>Recent Rentals</h2>
    <div id="rentals"></div>

    <script>
      async function fetchItems(){
        const res = await fetch('/api/admin/items');
        if (!res.ok) { document.getElementById('items').innerText = 'Unauthorized'; return; }
        const items = await res.json();
        const html = ['<table><tr><th>ID</th><th>Name</th><th>Category</th><th>Qty</th><th>Description</th></tr>'];
        for (const it of items){ html.push(`<tr><td>${it.id}</td><td>${it.name}</td><td>${it.category||''}</td><td>${it.quantity}</td><td>${it.description||''}</td></tr>`); }
        html.push('</table>');
        document.getElementById('items').innerHTML = html.join('');
        const sel = document.getElementById('r_item'); sel.innerHTML = '';
        for (const it of items){ const opt = document.createElement('option'); opt.value = it.id; opt.text = `${it.name} (qty ${it.quantity})`; sel.appendChild(opt); }
      }

      async function fetchRentals(){
        const res = await fetch('/api/admin/rentals');
        if (!res.ok) { document.getElementById('rentals').innerText = 'Unauthorized'; return; }
        const rows = await res.json();
        const html = ['<table><tr><th>ID</th><th>Item</th><th>Qty</th><th>Renter</th><th>Hire</th><th>Return</th><th>Price</th></tr>'];
        for (const r of rows){ html.push(`<tr><td>${r.id}</td><td>${r.item_name||r.item_id}</td><td>${r.quantity}</td><td>${r.renter_name||''}</td><td>${r.hire_date||''}</td><td>${r.return_date||''}</td><td>${r.price||''}</td></tr>`); }
        html.push('</table>');
        document.getElementById('rentals').innerHTML = html.join('');
      }

      document.getElementById('addItem').addEventListener('submit', async (e)=>{
        e.preventDefault();
        const data = Object.fromEntries(new FormData(e.target).entries());
        const res = await fetch('/api/admin/items', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify(data) });
        if (res.ok) { e.target.reset(); fetchItems(); } else alert((await res.json()).error || 'Error');
      });

      document.getElementById('addRental').addEventListener('submit', async (e)=>{
        e.preventDefault();
        const data = Object.fromEntries(new FormData(e.target).entries());
        const res = await fetch('/api/admin/rentals', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify(data) });
        if (res.ok) { e.target.reset(); fetchItems(); fetchRentals(); } else alert((await res.json()).error || 'Error');
      });

      document.getElementById('logout').addEventListener('click', async ()=>{ await fetch('/api/admin/logout',{method:'POST'}); window.location.href = '/'; });

      // initial load
      fetchItems(); fetchRentals();
    </script>
  </body>
</html>
